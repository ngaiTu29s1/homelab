version: '3.8'

services:
  # --- Monitor Core ---
  netdata:
    image: netdata/netdata:stable
    container_name: netdata
    # ... (giữ nguyên cấu hình cũ của người)
    restart: unless-stopped
    ports:
      - "19999:19999"
    networks:
      - homelab

  uptime-kuma:
    image: louislam/uptime-kuma:latest
    container_name: uptime-kuma
    ports:
      - "${KUMA_PORT}:3001"
    volumes:
      - uptime-kuma:/app/data
    restart: unless-stopped
    networks:
      - homelab

  # --- New Dashboard ---
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    ports:
      - "3005:3000" # Mặc định của Homepage
    env_file:
      - .env
    volumes:
      - ./homepage/config:/app/config # Nơi lưu file YAML
      - /var/run/docker.sock:/var/run/docker.sock:ro # Để lấy chỉ số CPU/RAM container
    restart: unless-stopped
    networks:
      - homelab
    environment:
      HOMEPAGE_ALLOWED_HOSTS: debian:3005,*.ts.net
      HOMEPAGE_VAR_OWM_API_KEY: ${OPEN_WEATHER_MAP_API_KEY}
      HOMEPAGE_VAR_PORTAINER_ACCESS_TOKEN: ${PORTAINER_ACCESS_TOKEN}

volumes:
  netdataconfig:
  netdatalib:
  netdatacache:
  uptime-kuma:

networks:
  homelab:
    external: true